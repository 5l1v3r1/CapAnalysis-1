<!DOCTYPE html>
<html>
	<head>
		 <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
		 <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
		 <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
		 <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
		 <script src="https://d3js.org/d3.v5.js"></script>
	</head>
	<style type="text/css">
		body{
			margin: 0;
			font-family: arial, sans;
		}

		#plot{
			margin: auto;
			width: 100%;
		}

		svg{
			display: block;
			margin: auto;
		}

		.label{
			font-size: 15px;
		}

		.legend text,
		.axis text {
			font-size: 13px;
			fill: #333;
		}

		.axis path,
		.axis line{
			fill: none;
			stroke-width: 1px;
			stroke: #777;
		}

		.circle{
			fill-opacity: 0.65;
		}

		.bubble{
			opacity: 1;
			transition: opacity 0.3s;
		}

		.bubble:hover text{
			opacity: 1;
		}

		.bubble:hover circle{
			fill-opacity: 1;
		}

		.legend rect{
			fill-opacity: 0.75;
		}

		.legeng:hover rect{
			fill-opacity:1;
		}
	</style>
	<body>
		<div id="plot"></div>
		<div class = "container">
			<div class = "emlpoyee-list"></div>
		</div>
	</body>
	<script type="text/javascript">
        var datalog = [];
        d3.csv("../scripts/analysisNew.csv").then(function(data) {
			data.forEach(function(d){
				d.Risk = parseFloat(d.Risk);
				d.ROI = parseFloat(d.ROI);
				d.empId = d.empId;
				d.color_risk = +d.color_risk;
			  });
			datalog = data;
	        var margin = { top: 40, right: 40, bottom: 30, left: 30 };
	        	width = 900 - margin.left - margin.right,
	        	height = 480 - margin.top - margin.bottom;
	        var color = d3.scaleOrdinal(d3.schemeCategory10);
	        var xpoint = "Risk";
	        var ypoint = "ROI";
	        var ccode = "color_risk";

	        var x = d3.scaleLinear()          
	              .range([0, width])
	              .nice();

	        var y = d3.scaleLinear()
	            .range([height, 0])
	            .nice();

	        var xAxis = d3.axisBottom(x).ticks(12),
	            yAxis = d3.axisLeft(y).ticks(12 * height / width);
	     
	        var svg = d3.select("#plot").append("svg")
	                    .attr("width", width + margin.left + margin.right)
	                    .attr("height", height + margin.top + margin.bottom)
	                    .append("g")
	                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	        var zoom = d3.zoom()
					    .scaleExtent([.5, 20])
					    .extent([[0, 0], [width, height]])
					    .on("zoom", zoomed);

			//Margins for clippings rect
			var rect_l = -5;
			var rect_r = 5;

			// Clipping region allocation
			svg.append("rect")
			    .attr("width", width)
			    .attr("height", height)
			    .style("fill", "none")
			    .style("pointer-events", "all")
			    .attr('transform', 'translate(' + rect_r + ',' + rect_l + ')')
			    .call(zoom);


			// Create clipping area so when zooming only required points show
			svg.append("defs").append("clipPath")
			    .attr("id", "clip")
			  .append("rect")
			    .attr("width", width)
			    .attr("height", height);

	        var xExtent = d3.extent(datalog, function (d) { return d[xpoint]; });
	        var yExtent = d3.extent(datalog, function (d) { return d[ypoint]; });
	        x.domain(d3.extent(datalog, function (d) { return d[xpoint]; })).nice();
	        y.domain(d3.extent(datalog, function (d) { return d[ypoint]; })).nice();

	        var points_g = svg.append("g")
			  .attr("clip-path", "url(#clip)")
			  .attr("id", "scatterplot")
			  .classed("points_g", true);

	        var points = points_g.selectAll(".dot")
	            .data(datalog)
	          .enter().append("circle")
	            .attr("class", "dot")
	            .attr("id", function(d){return RiskScore(d["color_risk"]);})
	            .attr("r", 2.5)
	            .attr("cx", function (d) { return x(d[xpoint]); })
	            .attr("cy", function (d) { return y(d[ypoint]); })
	            .attr("opacity", 0.5)
	            .style("fill", function (d) {return color(d["color_risk"]);})
	            .on("click",function (d) {displayEmployeeInfo(d);});

	        var gX = svg.append("g")
	           .attr("class", "x axis")
	           .attr('id', "axis--x")
	           .attr("transform", "translate(0," + height + ")")
	           .call(xAxis);

	        svg.append("text")
	         .style("text-anchor", "end")
	            .attr("x", width)
	            .attr("y", height - 8)
	         .text("Risk");

	        // y axis
	        var gY = svg.append("g")
	            .attr("class", "y axis")
	            .attr('id', "axis--y")
	            .call(yAxis);

	        svg.append("text")
	            .attr("transform", "rotate(-90)")
	            .attr("y", 6)
	            .attr("dy", "1em")
	            .style("text-anchor", "end")
	            .text("Work Output");

	        var legend = svg.selectAll(".legend")
			      .data(color.domain())
			    .enter().append("g")
			      .classed("legend", true)
			      .attr("transform", function(d, i) { return "translate(-180," + i * 20 + ")"; });

			legend.append("circle")
			      .attr("r", 5)
			      .attr("cx", width + 20)
			      .attr("fill", color);

			legend.append("text")
			      .attr("x", width + 26)
			      .attr("dy", ".35em")
			      .text(function(d) {return RiskScore(d);})
			      .on("click", function(d) {displayinfo(d);});

			function RiskScore(a){
				if (a == 0)
					return "Low Risk";
				if (a == 1)
					return "High Output, Low Risk"
				if (a == 2)
					return "Highly talented, Low output"
				if (a == 3)
					return "High Risk"
			}

	        function brushended() {

	            var s = d3.event.selection;
	            if (!s) {
	                if (!idleTimeout) return idleTimeout = setTimeout(idled, idleDelay);
	                x.domain(d3.extent(datalog, function (d) { return d[xpoint]; })).nice();
	                y.domain(d3.extent(datalog, function (d) { return d[ypoint]; })).nice();
	            } else {
	                
	                x.domain([s[0][0], s[1][0]].map(x.invert, x));
	                y.domain([s[1][1], s[0][1]].map(y.invert, y));
	                scatter.select(".brush").call(brush.move, null);
	            }
	            zoom2();
	        }

	        function zoomed() {
				// create new scale ojects based on event
				    var new_xScale = d3.event.transform.rescaleX(x);
				    var new_yScale = d3.event.transform.rescaleY(y);
				// update axes
				    gX.call(xAxis.scale(new_xScale));
				    gY.call(yAxis.scale(new_yScale));
				    points.data(data)
				     .attr('cx', function(d) {return new_xScale(d[xpoint])})
				     .attr('cy', function(d) {return new_yScale(d[ypoint])});
				}

	        var axisAppend = [true,true,true,true];
	        var data_points = document.getElementsByClassName("dot");
	        function displayEmployeeInfo(data_row){
	        	console.log(data_row);
	        }
	        function displayinfo(val){
	        	if(val == 0)
	        		axisAppend[0] = axisAppend[0] ? false : true;
	        	if(val == 1)
	        		axisAppend[1] = axisAppend[1] ? false : true;
	        	if(val == 2)
	        		axisAppend[2] = axisAppend[2] ? false : true;
	        	if(val == 3)
	        		axisAppend[3] = axisAppend[3] ? false : true;

	        	for (var i = 0; i < data_points.length; i++) {
	        		if(data_points[i].id == RiskScore(val)){
		        		if(val == 0)
		        			data_points[i].style.opacity = opacityFill(axisAppend[0]);
			        	if(val == 1)
			        		data_points[i].style.opacity = opacityFill(axisAppend[1]);
			        	if(val == 2)
			        		data_points[i].style.opacity = opacityFill(axisAppend[2]);
			        	if(val == 3)
			        		data_points[i].style.opacity = opacityFill(axisAppend[3]);
		        }
	        	}

	        }

	        function opacityFill(n){
	        	return (n ? 0.5 : 0);
	        }

	        var employeeInfo = d3.select(".emlpoyee-list").append("svg")
	        					.attr("width",width + margin.left + margin.right)
	        					.attr("height",height + margin.top + margin.bottom);
	    });
	</script>

</html>
